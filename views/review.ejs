<!DOCTYPE html>
<html lang="en">
    <%- include('./partials/head'); %>
    <body class="vh-100 vw-100 d-flex flex-column justify-content-between">
        <header>
            <% if (!!reviewer) { %>
                <nav class="navbar bg-light">
                    <div class="container-fluid">
                        <div>
                            <i class="bi bi-person-fill"></i>
                            <span class="navbar-brand mb-0 h1">
                                <%= reviewer.name %>
                            </span>
                        </div>
                    </div>
                </nav>
            <% } %>
        </header>
        <main>
            <% if (!!reviewer) { %>
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <h1 class="text-center m-3">Task: <%- instance.task %></h1>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col overflow-hidden">
                            <label class="mb-2">Input Source Code</label>
                            <pre class="border rounded"><code class="language-java"><%- instance.input_code || " "  %></code></pre>
                            <label class="mb-2">Input Comment</label>
                            <pre class="border rounded"><code class="language-plaintext"><%- instance.input_nl || " "  %></code></pre>
                        </div>
                        <div class="col-auto vr g-0"></div>
                        <div class="col overflow-hidden">
                            <% const language = instance.task === "C&NL2C" ? "java" : "plaintext" %>
                            <label class="mb-2">Actual Output</label>
                            <pre class="border rounded"><code class="language-<%- language %>"><%- instance.output || " "  %></code></pre>
                            <label class="mb-2">Expected Output</label>
                            <pre class="border rounded"><code class="language-<%- language %>"><%- instance.target || " " %></code></pre>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <h1 class="text-center mb-3">
                    <i class="bi bi-emoji-dizzy-fill"></i>
                    You Must Log In First!
                </h1>
                <%- include('./partials/home-button'); %>
            <% } %>
        </main>
        <%- include('./partials/footer'); %>
        <%- include('./partials/scripts'); %>
        <script>
            const labelSelect = document.getElementById("label-select");
            const labelAddForm = document.getElementById("label-add");
            const labelAddInput = document.getElementById("label-add-input");
            const labelAddToast = document.getElementById("label-add-toast");

            const normalize = (label) => {
              return label.replaceAll(/\s+/g, " ").toLowerCase().trim();
            }

            labelAddForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const label = normalize(labelAddInput.value);
                labelAddInput.value = null;

                axios.post("/label", { name: label })
                    .then(({ data }) => {
                        const option = document.createElement("option");
                        option.value = data.id;
                        option.innerHTML = data.name;
                        labelSelect.appendChild(option);
                    })
                    .catch(() => new bootstrap.Toast(labelAddToast).show())
            })
        </script>
        <script>
            hljs.highlightAll();
            hljs.initLineNumbersOnLoad({ singleLine: true });
        </script>
    </body>
</html>